<div id="fd-dashboard">
  <header class="fd-topbar">
    <div class="fd-logo">Foodly</div>

    <!-- Perfil -->
    <button class="fd-profile-btn" id="fdProfileBtn" aria-haspopup="true" aria-expanded="false">
      <%= image_tag "logo.png", class: "fd-avatar", alt: "User avatar" %>
    </button>

    <nav class="fd-dropdown" id="fdProfileMenu" aria-label="Profile menu">
      <%= link_to "Config", edit_user_registration_path %>
      <%= link_to "Edit",   edit_user_registration_path %>
      <%= link_to "Log out", destroy_user_session_path, method: :delete %>
    </nav>
  </header>

  <main class="fd-container">
    <% if @top_recipes.present? %>
      <section class="fd-carousel-section" aria-label="Most liked recipes">
        <h2 class="fd-section-title">Most liked recipes</h2>

        <div class="fd-carousel" id="fdCarousel">
          <button class="fd-car-arrow fd-left" id="fdCarPrev" aria-label="Previous">&#10094;</button>

          <div class="fd-car-track" id="fdCarTrack">
            <% @top_recipes.each do |recipe| %>
              <% title = recipe.respond_to?(:title) ? recipe.title : recipe.name %>
              <% likes = (recipe.try(:likes_count) || recipe['likes_count'] || 0).to_i %>
              <% href  = (recipe.scan_id ? scan_recipe_path(recipe.scan_id, recipe) : recipe_path(recipe)) %>

              <article class="fd-slide" data-title="<%= title %>">
                <%= link_to href, class: "fd-slide-link", "aria-label": "Open #{title}" do %>
                  <%= image_tag(recipe.try(:photo_url).presence || "logo.png", alt: title) %>
                  <div class="fd-slide-caption">
                    <h3 class="fd-slide-title"><%= title %></h3>
                    <span class="fd-slide-hearts">♥ <%= likes %></span>
                  </div>
                <% end %>
              </article>
            <% end %>
          </div>

          <button class="fd-car-arrow fd-right" id="fdCarNext" aria-label="Next">&#10095;</button>
        </div>
      </section>
    <% end %>

    <!-- Search -->
    <section class="fd-search-section">
      <%= form_with url: recipes_path, method: :get, local: true, role: "search" do |f| %>
        <%= f.search_field :query, placeholder: "Search for specifics…", class: "fd-pill", id: "fdSearchInput", value: params[:query] %>
      <% end %>
    </section>

    <!-- Grid -->
    <% if @recipes.present? %>
      <section class="fd-grid" id="fdRecipeGrid" aria-label="Recipes">
        <div class="row g-2 mt-3">
          <% @recipes.each_with_index do |recipe, index| %>
            <div class="col-6 fd-text-ink mb-1 mt-2 <%= index.even? ? "pe-2" : "ps-2" %>">
              <%= link_to (recipe.scan_id ? scan_recipe_path(recipe.scan_id, recipe) : recipe_path(recipe)),
                          class: "text-decoration-none fd-card-link" do %>
                <div class="position-relative">
                  <%= image_tag "https://images.unsplash.com/photo-1618666185561-baed3459ff18?q=80&w=1170&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D", class: "card-image rounded-circle" %>
                </div>
                <div class="fd-card-recipe flex-column p-1">
                  <div class="fd-text-ink text-center fs-6">
                    <p class="my-1 fd-recipe-title">
                      <%= recipe.respond_to?(:title) ? recipe.title : recipe.name %>
                    </p>
                    <div>
                      <span class="fd-duration">
                        <i class="fa-regular fa-clock"></i>
                        <%= recipe.try(:duration) || "-" %> Min
                      </span>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>
      </section>
    <% else %>
      <em class="fd-text-muted">Sorry, no recipes found.</em>
    <% end %>
  </main>

  <!-- Bottombar -->
  <nav class="fd-bottombar" aria-label="Primary">
    <%= link_to root_path, class: "fd-btn", id: "fdHomeBtn", "aria-label": "Home" do %>
      <i class="fa-solid fa-house"></i>
    <% end %>

    <%= link_to "/scans/new", class: "fd-btn fd-btn-accent", id: "fdScanBtn", "aria-label": "Scan / New" do %>
      <i class="fa-solid fa-camera"></i>
    <% end %>

    <%= link_to recipes_path, class: "fd-btn", id: "fdRecipesBtn", "aria-label": "Recipes" do %>
      <i class="fa-solid fa-book"></i>
    <% end %>
  </nav>
</div>

<style>
  /* Keep this to disable any floating button if present elsewhere */
  #floatingButton{ display: none; }
</style>
